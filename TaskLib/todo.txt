* implement main_loop.cpp logig into the official code
